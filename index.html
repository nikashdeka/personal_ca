<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Personal Finance Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      .chart-container {
        position: relative;
        width: 100%;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
        height: 350px;
        max-height: 400px;
      }
      @media (max-width: 768px) {
        .chart-container {
          height: 300px;
        }
      }
      .nav-item.active {
        background-color: #e0f2fe; /* light-sky-100 */
        color: #0284c7; /* sky-600 */
        font-weight: 600;
      }
      .tab-content {
        display: none;
      }
      .tab-content.active {
        display: block;
      }
      .kpi-card {
        background-color: white;
        border-radius: 0.75rem;
        padding: 1.5rem;
        box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1),
          0 2px 4px -2px rgb(0 0 0 / 0.1);
        transition: transform 0.2s;
      }
      .kpi-card:hover {
        transform: translateY(-5px);
      }
      .tax-input {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid #cbd5e1;
        border-radius: 0.375rem;
        font-size: 0.875rem;
      }
      .tax-tab {
        display: none;
      }
      .tax-tab.active {
        display: block;
      }
      .tax-tab-button {
        padding: 0.75rem 1rem;
        border-radius: 0.5rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        border: 2px solid transparent;
      }
      .tax-tab-button.active {
        background-color: #e0f2fe;
        color: #0284c7;
        border-color: #7dd3fc;
      }
      .tax-tab-button:not(.active):hover {
        background-color: #f1f5f9;
      }
      /* Modal styles */
      .modal-backdrop {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 40;
        justify-content: center;
        align-items: center;
      }
      .modal-content {
        background-color: white;
        padding: 2rem;
        border-radius: 0.75rem;
        max-width: 500px;
        width: 90%;
        text-align: center;
      }
      
      /* New Financial Planner Styles */
      .financial-planner-card {
        background-color: white;
        border-radius: 0.75rem;
        box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        transition: transform 0.2s, box-shadow 0.2s;
      }
      .financial-planner-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.1);
      }
      .btn-primary {
        background-color: #5A6F64; /* Soothing Sage */
        color: white;
      }
      .btn-primary:hover {
        background-color: #4B5D54;
      }
      .btn-danger {
        background-color: #E57373;
        color: white;
      }
      .btn-danger:hover {
        background-color: #EF5350;
      }
      .table-row-hover:hover {
        background-color: #f7f7f7;
      }
      .fp-chart-container {
        position: relative;
        width: 100%;
        max-width: 500px;
        margin-left: auto;
        margin-right: auto;
        height: 300px;
        max-height: 350px;
      }
    </style>
  </head>
  <body class="bg-slate-50 text-slate-800">
    <div id="alertModal" class="modal-backdrop">
      <div class="modal-content">
        <h3 id="modalTitle" class="text-xl font-bold mb-4">Notification</h3>
        <p id="modalMessage" class="mb-6"></p>
        <button
          id="modalCloseBtn"
          class="bg-sky-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-sky-600"
        >
          Close
        </button>
      </div>
    </div>

    <div class="flex min-h-screen">
      <aside
        id="sidebar"
        class="bg-white w-64 p-4 shadow-lg fixed lg:relative -translate-x-full lg:translate-x-0 transition-transform duration-300 z-20"
      >
        <div class="flex items-center mb-8">
          <div class="bg-sky-500 text-white p-3 rounded-full mr-3">
            <i class="fas fa-landmark"></i>
          </div>
          <h1 class="text-xl font-bold text-slate-700">Financial Advisor</h1>
        </div>
        <nav id="main-nav">
          <a
            href="#dashboard"
            class="nav-item flex items-center p-3 my-1 rounded-lg hover:bg-slate-100 transition-colors duration-200 active"
          >
            <i class="fas fa-tachometer-alt w-6 text-center mr-3"></i> Dashboard
          </a>
          <a
            href="#tax-centre"
            class="nav-item flex items-center p-3 my-1 rounded-lg hover:bg-slate-100 transition-colors duration-200"
          >
            <i class="fas fa-calculator w-6 text-center mr-3"></i> Tax Centre
          </a>
          <a
            href="#financial-planner"
            class="nav-item flex items-center p-3 my-1 rounded-lg hover:bg-slate-100 transition-colors duration-200"
          >
            <i class="fas fa-wallet w-6 text-center mr-3"></i> Financial Planner
          </a>
          <a
            href="#fortress"
            class="nav-item flex items-center p-3 my-1 rounded-lg hover:bg-slate-100 transition-colors duration-200"
          >
            <i class="fas fa-shield-halved w-6 text-center mr-3"></i> Financial
            Fortress
          </a>
          <a
            href="#wealth-engine"
            class="nav-item flex items-center p-3 my-1 rounded-lg hover:bg-slate-100 transition-colors duration-200"
          >
            <i class="fas fa-chart-line w-6 text-center mr-3"></i> Wealth Engine
          </a>
          <a
            href="#action-plan"
            class="nav-item flex items-center p-3 my-1 rounded-lg hover:bg-slate-100 transition-colors duration-200"
          >
            <i class="fas fa-tasks w-6 text-center mr-3"></i> Action Plan
          </a>
        </nav>
      </aside>

      <main class="flex-1 p-4 md:p-8 lg:p-10 bg-slate-50">
        <button
          id="menu-toggle"
          class="lg:hidden fixed top-4 left-4 z-30 bg-white p-2 rounded-md shadow-md"
        >
          <i class="fas fa-bars"></i>
        </button>

        <section id="dashboard" class="tab-content active">
          <h2 class="text-3xl font-bold text-slate-800 mb-2">
            Your Financial Dashboard
          </h2>
          <p class="text-slate-500 mb-8">
            A summary of your key financial metrics and recommendations for FY
            2024-25.
          </p>

          <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
            <div class="kpi-card xl:col-span-2">
              <div class="flex items-center text-amber-500 mb-3">
                <i class="fas fa-star text-2xl mr-3"></i>
                <h3 class="text-xl font-semibold text-slate-700">
                  Primary Recommendation: Adopt Old Tax Regime
                </h3>
              </div>
              <p class="text-slate-600 mb-4">
                Based on your high rental expenses and eligibility for key
                deductions, the Old Tax Regime is significantly more beneficial.
                This choice is the cornerstone of your tax-saving strategy for
                this year.
              </p>
              <div
                class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded-r-lg"
              >
                <p class="font-bold">Estimated Annual Tax Savings:</p>
                <p id="estimatedSavings" class="text-3xl font-bold">₹ 78,000</p>
                <p class="text-sm">
                  Compared to the New Tax Regime. Explore the Tax Centre for a
                  detailed breakdown.
                </p>
              </div>
            </div>

            <div class="kpi-card">
              <div class="flex items-center text-sky-500 mb-3">
                <i class="fas fa-heart-pulse text-2xl mr-3"></i>
                <h3 class="text-xl font-semibold text-slate-700">
                  Life Insurance Goal
                </h3>
              </div>
              <p class="text-slate-600 mb-4">
                To fully protect your family's future, a substantial life cover
                is essential.
              </p>
              <div class="text-center">
                <p class="text-slate-500">Recommended Term Cover</p>
                <p class="text-4xl font-bold text-sky-600">₹ 2.5 Cr</p>
              </div>
            </div>

            <div class="kpi-card">
              <div class="flex items-center text-indigo-500 mb-3">
                <i class="fas fa-chart-pie text-2xl mr-3"></i>
                <h3 class="text-xl font-semibold text-slate-700">
                  Investment Strategy
                </h3>
              </div>
              <p class="text-slate-600">
                A growth-oriented portfolio to build wealth over the long term.
              </p>
              <div class="chart-container h-64 max-h-64">
                <canvas id="assetAllocationChart"></canvas>
              </div>
            </div>

            <div class="kpi-card">
              <div class="flex items-center text-emerald-500 mb-3">
                <i class="fas fa-suitcase-medical text-2xl mr-3"></i>
                <h3 class="text-xl font-semibold text-slate-700">
                  Emergency Fund
                </h3>
              </div>
              <p class="text-slate-600 mb-4">
                Your financial safety net. Aim for 6 months of essential
                expenses.
              </p>
              <div class="text-center">
                <p class="text-slate-500">Target Corpus</p>
                <p class="text-4xl font-bold text-emerald-600">₹ 8 Lakhs+</p>
                <p class="text-sm">(based on illustrative expenses)</p>
              </div>
            </div>

            <div class="kpi-card bg-sky-500 text-white">
              <div class="flex items-center mb-3">
                <i class="fas fa-arrow-right text-2xl mr-3"></i>
                <h3 class="text-xl font-semibold">Your Next Step</h3>
              </div>
              <p class="mb-4">
                Begin your journey to financial wellness by exploring the
                detailed sections.
              </p>
              <button
                onclick="document.querySelector('a[href=\'#action-plan\']').click()"
                class="bg-white text-sky-600 font-bold py-2 px-4 rounded-lg w-full hover:bg-sky-100 transition-colors"
              >
                View Your Action Plan
              </button>
            </div>
          </div>
        </section>

        <section id="tax-centre" class="tab-content">
          <h2 class="text-3xl font-bold text-slate-800 mb-2">Tax Centre</h2>
          <p class="text-slate-500 mb-8">
            Enter your detailed financial data to get a precise tax comparison
            and maximize your savings.
          </p>

          <div class="bg-white p-6 rounded-lg shadow-md">
            <div class="mb-8 p-4 bg-sky-50 border border-sky-200 rounded-lg">
              <h3 class="text-xl font-semibold text-slate-700 mb-2">
                Payslip Analyzer (AI)
              </h3>
              <p class="text-slate-600 mb-4">
                Upload a clear image or PDF of your payslip to automatically
                fill in the salary details below. Please review the populated
                fields for accuracy.
              </p>
              <div class="flex items-center space-x-4">
                <input
                  type="file"
                  id="payslipUploader"
                  accept="image/*,application/pdf"
                  class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-sky-100 file:text-sky-700 hover:file:bg-sky-200"
                />
                <button
                  id="analyzePayslipBtn"
                  class="bg-sky-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-sky-600 disabled:bg-slate-400"
                  disabled
                >
                  Analyze
                </button>
              </div>
              <div
                id="aiStatus"
                class="mt-2 text-sm font-medium text-slate-600"
              ></div>
            </div>

            <div class="flex flex-wrap space-x-2 border-b mb-6">
              <button class="tax-tab-button active" data-tab="income">
                1. Income Details
              </button>
              <button class="tax-tab-button" data-tab="property">
                2. House Property
              </button>
              <button class="tax-tab-button" data-tab="deductions">
                3. Deductions
              </button>
            </div>

            <div id="tax-calculator-form">
              <div id="tab-income" class="tax-tab active space-y-6">
                <div>
                  <h3
                    class="font-semibold text-lg mb-4 text-slate-700 border-b pb-2"
                  >
                    Salary Components
                  </h3>
                  <div
                    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"
                  >
                    <div>
                      <label class="text-sm">Basic Salary</label
                      ><input
                        type="number"
                        id="basic_salary"
                        class="tax-input"
                        value="1800000"
                      />
                    </div>
                    <div>
                      <label class="text-sm">Basic Arrear</label
                      ><input
                        type="number"
                        id="basic_arrear"
                        class="tax-input"
                        value="0"
                      />
                    </div>
                    <div>
                      <label class="text-sm">HRA Received</label
                      ><input
                        type="number"
                        id="hra_received"
                        class="tax-input"
                        value="700000"
                      />
                    </div>
                    <div>
                      <label class="text-sm">HRA Arrear</label
                      ><input
                        type="number"
                        id="hra_arrear"
                        class="tax-input"
                        value="0"
                      />
                    </div>
                    <div>
                      <label class="text-sm">LTA</label
                      ><input
                        type="number"
                        id="lta"
                        class="tax-input"
                        value="50000"
                      />
                    </div>
                    <div>
                      <label class="text-sm">Performance Bonus</label
                      ><input
                        type="number"
                        id="performance_bonus"
                        class="tax-input"
                        value="200000"
                      />
                    </div>
                  </div>
                </div>

                <div>
                  <h3
                    class="font-semibold text-lg mb-4 text-slate-700 border-b pb-2"
                  >
                    Taxable Allowances & Perquisites
                  </h3>
                  <div
                    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"
                  >
                    <div>
                      <label class="text-sm">Professional Development</label
                      ><input
                        type="number"
                        id="prof_dev_allowance"
                        class="tax-input"
                        value="0"
                      />
                    </div>
                    <div>
                      <label class="text-sm">Books & Periodicals</label
                      ><input
                        type="number"
                        id="books_allowance"
                        class="tax-input"
                        value="0"
                      />
                    </div>
                    <div>
                      <label class="text-sm">Telephone/Internet</label
                      ><input
                        type="number"
                        id="tele_allowance"
                        class="tax-input"
                        value="0"
                      />
                    </div>
                    <div>
                      <label class="text-sm">Health/Sports Club</label
                      ><input
                        type="number"
                        id="health_club_allowance"
                        class="tax-input"
                        value="0"
                      />
                    </div>
                    <div>
                      <label class="text-sm">Gift Voucher Value</label
                      ><input
                        type="number"
                        id="gift_voucher_value"
                        class="tax-input"
                        value="0"
                      />
                    </div>
                    <div>
                      <label class="text-sm">Sodexo / Meal Vouchers</label
                      ><input
                        type="number"
                        id="sodexo_value"
                        class="tax-input"
                        value="0"
                      />
                    </div>
                    <div>
                      <label class="text-sm">Other Taxable Allowances</label
                      ><input
                        type="number"
                        id="other_allowance"
                        class="tax-input"
                        value="100000"
                      />
                    </div>
                    <div>
                      <label class="text-sm">Motor Car Perquisite</label
                      ><input
                        type="number"
                        id="car_perq"
                        class="tax-input"
                        value="28800"
                      />
                    </div>
                  </div>
                </div>

                <div>
                  <h3
                    class="font-semibold text-lg mb-4 text-slate-700 border-b pb-2"
                  >
                    Employer & Employee Contributions
                  </h3>
                  <div
                    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"
                  >
                    <div>
                      <label class="text-sm">Employer PF Contribution</label
                      ><input
                        type="number"
                        id="employer_pf_contribution"
                        class="tax-input"
                        value="216000"
                      />
                    </div>
                    <div>
                      <label class="text-sm">Employer NPS Contribution</label
                      ><input
                        type="number"
                        id="employer_nps_contribution"
                        class="tax-input"
                        value="0"
                      />
                    </div>
                    <div>
                      <label class="text-sm">Employer Superannuation</label
                      ><input
                        type="number"
                        id="employer_superannuation_contribution"
                        class="tax-input"
                        value="0"
                      />
                    </div>
                    <div>
                      <label class="text-sm">Employee PF Contribution</label
                      ><input
                        type="number"
                        id="epf"
                        class="tax-input"
                        value="75000"
                      />
                    </div>
                    <div>
                      <label class="text-sm">Employee Professional Tax</label
                      ><input
                        type="number"
                        id="prof_tax"
                        class="tax-input"
                        value="2400"
                      />
                    </div>
                  </div>
                </div>

                <div>
                  <h3
                    class="font-semibold text-lg mb-4 text-slate-700 border-b pb-2"
                  >
                    Other Income Sources
                  </h3>
                  <div
                    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"
                  >
                    <div>
                      <label class="text-sm"
                        >Interest Income (Savings, FD)</label
                      ><input
                        type="number"
                        id="interest_income"
                        class="tax-input"
                        value="25000"
                      />
                    </div>
                    <div>
                      <label class="text-sm">Any Other Income</label
                      ><input
                        type="number"
                        id="any_other_income"
                        class="tax-input"
                        value="0"
                      />
                    </div>
                  </div>
                </div>
              </div>

              <div id="tab-property" class="tax-tab">
                <div class="flex justify-between items-center mb-4">
                  <h3 class="font-semibold text-lg text-slate-700">
                    Income from House Property
                  </h3>
                  <button
                    id="add-property-btn"
                    class="bg-sky-500 text-white text-sm font-bold py-2 px-3 rounded-lg hover:bg-sky-600 transition-colors"
                  >
                    <i class="fas fa-plus mr-2"></i>Add Property
                  </button>
                </div>
                <div id="property-list" class="space-y-4">
                  </div>
              </div>

              <div id="tab-deductions" class="tax-tab">
                <h3 class="font-semibold text-lg mb-4 text-slate-700">
                  Tax Saving Deductions (for Old Regime)
                </h3>
                <div
                  class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
                >
                  <div class="space-y-4 p-4 bg-slate-50 rounded-lg">
                    <h4 class="font-semibold text-slate-600 border-b pb-2">
                      Section 80C Investments
                    </h4>
                    <div>
                      <label class="text-sm">Life Insurance Premium</label
                      ><input
                        type="number"
                        id="lic"
                        class="tax-input"
                        value="25000"
                      />
                    </div>
                    <div>
                      <label class="text-sm">Tuition Fees</label
                      ><input
                        type="number"
                        id="tuition_fees"
                        class="tax-input"
                        value="80000"
                      />
                    </div>
                    <div>
                      <label class="text-sm">Other 80C (PPF, ELSS, etc)</label
                      ><input
                        type="number"
                        id="other_80c"
                        class="tax-input"
                        value="0"
                      />
                    </div>
                    <p class="text-xs text-slate-500">
                      Note: Your EPF contribution is automatically included in
                      the 80C calculation.
                    </p>
                  </div>
                  <div class="space-y-4 p-4 bg-slate-50 rounded-lg">
                    <h4 class="font-semibold text-slate-600 border-b pb-2">
                      Health (Sec 80D)
                    </h4>
                    <div>
                      <label class="text-sm"
                        >Health Insurance (Self/Family)</label
                      ><input
                        type="number"
                        id="health_insurance_self"
                        class="tax-input"
                        value="25000"
                      />
                    </div>
                    <div>
                      <label class="text-sm"
                        >Health Insurance (Parents < 60)</label
                      ><input
                        type="number"
                        id="health_insurance_parents"
                        class="tax-input"
                        value="0"
                      />
                    </div>
                    <div>
                      <label class="text-sm"
                        >Health Insurance (Parents >= 60)</label
                      ><input
                        type="number"
                        id="health_insurance_parents_sr"
                        class="tax-input"
                        value="50000"
                      />
                    </div>
                  </div>
                  <div class="space-y-4 p-4 bg-slate-50 rounded-lg">
                    <h4 class="font-semibold text-slate-600 border-b pb-2">
                      Other Deductions & Exemptions
                    </h4>
                    <div>
                      <label class="text-sm">Rent Paid Annually (for HRA)</label
                      ><input
                        type="number"
                        id="rent_paid"
                        class="tax-input"
                        value="840000"
                      />
                    </div>
                    <div>
                      <label class="text-sm">Metro City? (for HRA)</label
                      ><input
                        type="checkbox"
                        id="is_metro"
                        class="h-5 w-5 rounded border-gray-300 text-sky-600 focus:ring-sky-500"
                        checked
                      />
                    </div>
                    <div>
                      <label class="text-sm"
                        >Interest on Savings A/C (80TTA)</label
                      ><input
                        type="number"
                        id="interest_80tta"
                        class="tax-input"
                        value="10000"
                      />
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="mt-8 pt-6 border-t">
              <h3 class="text-xl font-semibold text-slate-700 mb-4">
                Report Management
              </h3>
              <div
                class="p-4 bg-slate-100 rounded-lg grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end"
              >
                <div>
                  <label
                    for="reportName"
                    class="text-sm font-medium text-slate-600"
                    >Report Name</label
                  >
                  <input
                    type="text"
                    id="reportName"
                    class="tax-input mt-1"
                    placeholder="e.g., FY 2024-25 Plan"
                  />
                </div>
                <div>
                  <label
                    for="savedReports"
                    class="text-sm font-medium text-slate-600"
                    >Saved Reports</label
                  >
                  <select id="savedReports" class="tax-input mt-1"></select>
                </div>
                <div class="flex space-x-2">
                  <button
                    id="saveReportBtn"
                    class="bg-sky-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-sky-600 w-full"
                  >
                    Save
                  </button>
                  <button
                    id="loadReportBtn"
                    class="bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600 w-full"
                  >
                    Load
                  </button>
                </div>
                <div>
                  <button
                    id="deleteReportBtn"
                    class="bg-red-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-600 w-full"
                  >
                    Delete Selected
                  </button>
                </div>
              </div>
            </div>

            <div class="mt-8 pt-6 border-t">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div>
                  <h3 class="text-xl font-semibold text-slate-700 mb-4">
                    Tax Calculation Summary
                  </h3>
                  <div class="space-y-3">
                    <div class="flex justify-between p-3 bg-sky-50 rounded-lg">
                      <span class="font-semibold text-sky-800"
                        >Taxable Income (Old Regime)</span
                      >
                      <span id="taxable_old" class="font-bold text-sky-900"
                        >₹ 0</span
                      >
                    </div>
                    <div
                      class="flex justify-between p-3 bg-amber-50 rounded-lg"
                    >
                      <span class="font-semibold text-amber-800"
                        >Taxable Income (New Regime)</span
                      >
                      <span id="taxable_new" class="font-bold text-amber-900"
                        >₹ 0</span
                      >
                    </div>
                    <div
                      class="flex justify-between p-4 bg-green-100 border-l-4 border-green-500 rounded-r-lg mt-4"
                    >
                      <span class="font-bold text-green-800 text-lg"
                        >Potential Savings</span
                      >
                      <span
                        id="savings_total"
                        class="font-extrabold text-green-700 text-lg"
                        >₹ 0</span
                      >
                    </div>
                  </div>
                </div>
                <div>
                  <div class="chart-container">
                    <canvas id="taxComparisonChart"></canvas>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        
        <section id="financial-planner" class="tab-content">
            <h2 class="text-3xl font-bold text-slate-800 mb-2">Personal Financial Planner</h2>
            <p class="text-slate-500 mb-8">
                Your interactive tool to track income, manage expenses, and see your financial health in real-time.
            </p>
            <main>
              <section id="kpis" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
                  <div class="financial-planner-card p-6 flex flex-col justify-center items-center">
                      <h2 class="text-lg font-semibold text-slate-500">Total Income</h2>
                      <p id="totalIncome" class="text-3xl font-bold text-green-600 mt-2">₹0.00</p>
                  </div>
                  <div class="financial-planner-card p-6 flex flex-col justify-center items-center">
                      <h2 class="text-lg font-semibold text-slate-500">Total Expenses</h2>
                      <p id="totalExpenses" class="text-3xl font-bold text-red-600 mt-2">₹0.00</p>
                  </div>
                  <div class="financial-planner-card p-6 flex flex-col justify-center items-center">
                      <h2 class="text-lg font-semibold text-slate-500">Total Savings</h2>
                      <p id="totalSavings" class="text-3xl font-bold text-blue-600 mt-2">₹0.00</p>
                  </div>
                  <div class="financial-planner-card p-6 flex flex-col justify-center items-center">
                      <h2 id="netSurplusTitle" class="text-lg font-semibold text-slate-500">Net Surplus</h2>
                      <p id="netSurplus" class="text-3xl font-bold text-slate-800 mt-2">₹0.00</p>
                  </div>
              </section>

              <section class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
                  <div class="financial-planner-card p-6">
                      <h3 class="text-xl font-semibold text-center mb-4">Financial Overview</h3>
                      <p class="text-center text-sm text-slate-500 mb-4">This chart shows the allocation of your total income. A larger savings slice is the primary driver of wealth creation.</p>
                      <div class="fp-chart-container">
                          <canvas id="overviewChart"></canvas>
                      </div>
                  </div>
                  <div class="financial-planner-card p-6">
                      <h3 class="text-xl font-semibold text-center mb-4">Expense Breakdown</h3>
                      <p class="text-center text-sm text-slate-500 mb-4">This chart highlights your largest spending categories. Identifying these is the first step to optimizing your budget.</p>
                      <div class="fp-chart-container h-[350px] md:h-[400px] max-h-[450px]">
                          <canvas id="expenseChart"></canvas>
                      </div>
                  </div>
              </section>

              <section id="data-entry">
                  <h2 class="text-3xl font-bold text-center mb-8 text-slate-800">Manage Your Finances</h2>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                      
                      <div class="financial-planner-card p-6">
                          <h3 class="text-xl font-semibold mb-4">Income Sources</h3>
                          <table class="w-full text-left">
                              <tbody id="incomeTableBody" data-type="income"></tbody>
                          </table>
                          <div class="mt-4 flex gap-2" data-type="income">
                              <input type="text" placeholder="Description" class="w-2/3 tax-input" id="newIncomeDesc">
                              <input type="number" placeholder="Amount (₹)" class="w-1/3 tax-input" id="newIncomeAmount">
                              <button class="btn-primary px-4 py-2 rounded-md font-semibold text-sm add-item-btn">Add</button>
                          </div>
                      </div>

                      <div class="financial-planner-card p-6">
                          <h3 class="text-xl font-semibold mb-4">Savings & Investments</h3>
                          <table class="w-full text-left">
                              <tbody id="savingsTableBody" data-type="savings"></tbody>
                          </table>
                          <div class="mt-4 flex gap-2" data-type="savings">
                              <input type="text" placeholder="Description" class="w-2/3 tax-input" id="newSavingsDesc">
                              <input type="number" placeholder="Amount (₹)" class="w-1/3 tax-input" id="newSavingsAmount">
                              <button class="btn-primary px-4 py-2 rounded-md font-semibold text-sm add-item-btn">Add</button>
                          </div>
                      </div>

                      <div class="financial-planner-card p-6">
                          <h3 class="text-xl font-semibold mb-4">Fixed Expenses</h3>
                          <table class="w-full text-left">
                              <tbody id="fixedExpensesTableBody" data-type="fixedExpenses"></tbody>
                          </table>
                          <div class="mt-4 flex gap-2" data-type="fixedExpenses">
                              <input type="text" placeholder="Description" class="w-2/3 tax-input" id="newFixedDesc">
                              <input type="number" placeholder="Amount (₹)" class="w-1/3 tax-input" id="newFixedAmount">
                              <button class="btn-primary px-4 py-2 rounded-md font-semibold text-sm add-item-btn">Add</button>
                          </div>
                      </div>
                      
                      <div class="financial-planner-card p-6">
                          <h3 class="text-xl font-semibold mb-4">Variable Expenses</h3>
                          <table class="w-full text-left">
                              <tbody id="variableExpensesTableBody" data-type="variableExpenses"></tbody>
                          </table>
                          <div class="mt-4 flex gap-2" data-type="variableExpenses">
                              <input type="text" placeholder="Description" class="w-2/3 tax-input" id="newVariableDesc">
                              <input type="number" placeholder="Amount (₹)" class="w-1/3 tax-input" id="newVariableAmount">
                              <button class="btn-primary px-4 py-2 rounded-md font-semibold text-sm add-item-btn">Add</button>
                          </div>
                      </div>
                  </div>
              </section>

              <section class="mt-12">
                  <h2 class="text-3xl font-bold text-center mb-8 text-slate-800">Wealth Building Insights</h2>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                      <div class="financial-planner-card p-6">
                          <h3 class="text-xl font-semibold mb-3">The 50/30/20 Rule</h3>
                          <p class="text-slate-600">A simple yet powerful budgeting guideline. Allocate 50% of your after-tax income to **Needs** (rent, groceries, utilities), 30% to **Wants** (dining out, hobbies, entertainment), and a crucial 20% to **Savings & Investments**. This dashboard helps you see how your spending aligns with this wealth-building framework.</p>
                      </div>
                      <div class="financial-planner-card p-6">
                          <h3 class="text-xl font-semibold mb-3">Pay Yourself First</h3>
                          <p class="text-slate-600">The most effective strategy for building wealth is to treat your savings and investments as a non-negotiable "bill." Before you pay for rent or groceries, allocate a portion of your income to your investment accounts. Automate this process to build financial discipline effortlessly.</p>
                      </div>
                  </div>
              </section>
          </main>
        </section>

        <section id="fortress" class="tab-content">
          <h2 class="text-3xl font-bold text-slate-800 mb-2">
            Financial Fortress
          </h2>
          <p class="text-slate-500 mb-8">
            Build your financial bedrock with adequate insurance and a robust
            emergency fund.
          </p>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="bg-white p-6 rounded-lg shadow-md">
              <h3 class="text-xl font-semibold text-slate-700 mb-4">
                Insurance Hub
              </h3>
              <p class="text-slate-600 mb-6">
                Protect against life's biggest risks. A layered approach
                provides the best, most cost-effective coverage.
              </p>

              <div class="space-y-4">
                <div class="p-4 border rounded-lg">
                  <p class="font-bold text-sky-600">
                    Life Insurance (Term Plan)
                  </p>
                  <p>
                    Recommended Cover:
                    <span class="font-bold text-xl">₹2.5 - 3 Crore</span>
                  </p>
                  <p class="text-sm text-slate-500">
                    To replace your income and secure your family's goals.
                  </p>
                </div>
                <div class="p-4 border rounded-lg">
                  <p class="font-bold text-sky-600">
                    Health Insurance (Your Family)
                  </p>
                  <p>
                    Base Cover:
                    <span class="font-bold text-xl">₹20 - 30 Lakhs</span>
                  </p>
                  <p class="text-sm text-slate-500">
                    A family floater for you, your spouse, and child.
                  </p>
                </div>
                <div class="p-4 border rounded-lg">
                  <p class="font-bold text-sky-600">
                    Health Insurance (Parents)
                  </p>
                  <p>
                    Base Cover:
                    <span class="font-bold text-xl">₹15 - 20 Lakhs</span>
                  </p>
                  <p class="text-sm text-slate-500">
                    A separate senior citizen policy for comprehensive care.
                  </p>
                </div>
                <div class="p-4 border border-dashed rounded-lg bg-slate-50">
                  <p class="font-bold text-green-600">Super Top-Up Plan</p>
                  <p>
                    Suggested Cover:
                    <span class="font-bold text-xl">₹1 Crore</span>
                  </p>
                  <p class="text-sm text-slate-500">
                    A cost-effective way to get high coverage for catastrophic
                    events, with a deductible matching your base policy.
                  </p>
                </div>
              </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-md">
              <h3 class="text-xl font-semibold text-slate-700 mb-4">
                Emergency Fund Planner
              </h3>
              <p class="text-slate-600 mb-6">
                Calculate the ideal size of your contingency fund. This money
                should be kept in liquid, easily accessible instruments.
              </p>

              <div>
                <label
                  for="monthlyExpenses"
                  class="block text-sm font-medium text-slate-600"
                  >Your Essential Monthly Expenses (₹)</label
                >
                <input
                  type="number"
                  id="monthlyExpenses"
                  value="120000"
                  class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm placeholder-slate-400 focus:outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500"
                />
                <p class="text-xs text-slate-500 mt-1">
                  Include rent, essential bills, EMIs, groceries, etc.
                </p>
              </div>
              <div class="mt-6 text-center bg-emerald-50 p-6 rounded-lg">
                <p class="text-lg font-medium text-emerald-800">
                  Your Target 6-Month Emergency Fund:
                </p>
                <p
                  id="emergencyFundTarget"
                  class="text-4xl font-extrabold text-emerald-600 mt-2"
                >
                  ₹ 7,20,000
                </p>
              </div>
            </div>
          </div>
        </section>

        <section id="wealth-engine" class="tab-content">
          <h2 class="text-3xl font-bold text-slate-800 mb-2">Wealth Engine</h2>
          <p class="text-slate-500 mb-8">
            Strategies for long-term wealth creation and goal-based investing.
          </p>

          <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
            <div class="lg:col-span-3 bg-white p-6 rounded-lg shadow-md">
              <h3 class="text-xl font-semibold text-slate-700 mb-4">
                Goal-Based Investment Plan
              </h3>
              <p class="text-slate-600 mb-6">
                A structured approach to investing ensures you meet your life's
                most important financial milestones. Here are the recommended
                strategies for each goal.
              </p>
              <div class="space-y-4">
                <details
                  class="group bg-slate-50 p-4 rounded-lg cursor-pointer"
                >
                  <summary
                    class="font-semibold text-lg text-slate-800 flex justify-between items-center"
                  >
                    Retirement Planning
                    <i
                      class="fas fa-chevron-down group-open:rotate-180 transition-transform"
                    ></i>
                  </summary>
                  <div class="mt-4 text-slate-600 border-t pt-4">
                    <p class="font-bold">Instruments:</p>
                    <ul class="list-disc list-inside mt-2 space-y-1">
                      <li>
                        <strong class="text-indigo-600">NPS:</strong> Maximize
                        for tax benefits (including ₹50k extra) and low-cost
                        growth.
                      </li>
                      <li>
                        <strong class="text-indigo-600">EPF:</strong> Forms the
                        stable debt anchor of your portfolio.
                      </li>
                      <li>
                        <strong class="text-indigo-600"
                          >Equity Mutual Fund SIPs:</strong
                        >
                        Dedicated long-term SIPs to build an inflation-beating
                        corpus.
                      </li>
                    </ul>
                  </div>
                </details>
                <details
                  class="group bg-slate-50 p-4 rounded-lg cursor-pointer"
                >
                  <summary
                    class="font-semibold text-lg text-slate-800 flex justify-between items-center"
                  >
                    Child's Future
                    <i
                      class="fas fa-chevron-down group-open:rotate-180 transition-transform"
                    ></i>
                  </summary>
                  <div class="mt-4 text-slate-600 border-t pt-4">
                    <p class="font-bold">
                      Strategy: Unbundle Insurance & Investment
                    </p>
                    <p class="mt-2">
                      Avoid costly, inefficient child plans. Use your term plan
                      for risk cover and invest directly for returns.
                    </p>
                    <ul class="list-disc list-inside mt-2 space-y-1">
                      <li>
                        <strong class="text-indigo-600">Investment:</strong>
                        Start a dedicated long-term SIP in a diversified equity
                        mutual funds.
                      </li>
                      <li>
                        <strong class="text-indigo-600">Goal:</strong> Earmark
                        this portfolio to build a substantial corpus for higher
                        education.
                      </li>
                    </ul>
                  </div>
                </details>
                <details
                  class="group bg-slate-50 p-4 rounded-lg cursor-pointer"
                >
                  <summary
                    class="font-semibold text-lg text-slate-800 flex justify-between items-center"
                  >
                    Parents' Financial Care
                    <i
                      class="fas fa-chevron-down group-open:rotate-180 transition-transform"
                    ></i>
                  </summary>
                  <div class="mt-4 text-slate-600 border-t pt-4">
                    <p class="font-bold">
                      Strategy: Capital Preservation & Regular Income
                    </p>
                    <p class="mt-2">
                      Focus on safe, government-backed schemes to supplement
                      their pension.
                    </p>
                    <ul class="list-disc list-inside mt-2 space-y-1">
                      <li>
                        <strong class="text-indigo-600"
                          >Senior Citizen Savings Scheme (SCSS):</strong
                        >
                        Top priority for high, guaranteed returns.
                      </li>
                      <li>
                        <strong class="text-indigo-600"
                          >Post Office MIS (POMIS):</strong
                        >
                        To generate fixed monthly income.
                      </li>
                    </ul>
                  </div>
                </details>
              </div>
            </div>
            <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md">
              <h3 class="text-xl font-semibold text-slate-700 mb-4">
                Core & Satellite Equity Strategy
              </h3>
              <p class="text-slate-600 mb-6">
                For your interest in direct stocks, adopt a disciplined approach
                to balance stable growth with focused bets.
              </p>
              <div class="relative pt-4">
                <div class="flex mb-2 items-center justify-between">
                  <div>
                    <span
                      class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-sky-600 bg-sky-200"
                    >
                      Core: 80-90%
                    </span>
                  </div>
                </div>
                <div
                  class="overflow-hidden h-4 mb-4 text-xs flex rounded bg-sky-100"
                >
                  <div
                    style="width: 85%"
                    class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-sky-500"
                  ></div>
                </div>
                <p class="text-sm text-slate-500 -mt-2">
                  Invested in diversified mutual funds for stable, long-term
                  growth.
                </p>
              </div>
              <div class="relative pt-4">
                <div class="flex mb-2 items-center justify-between">
                  <div>
                    <span
                      class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-amber-600 bg-amber-200"
                    >
                      Satellite: 10-20%
                    </span>
                  </div>
                </div>
                <div
                  class="overflow-hidden h-4 mb-4 text-xs flex rounded bg-amber-100"
                >
                  <div
                    style="width: 15%"
                    class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-amber-500"
                  ></div>
                </div>
                <p class="text-sm text-slate-500 -mt-2">
                  Allocated to direct stocks based on fundamental research, not
                  speculation.
                </p>
              </div>
            </div>
          </div>
        </section>

        <section id="action-plan" class="tab-content">
          <h2 class="text-3xl font-bold text-slate-800 mb-2">
            Your Action Plan
          </h2>
          <p class="text-slate-500 mb-8">
            A prioritized checklist to guide your next steps. Focus on one
            section at a time to build momentum.
          </p>

          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div
              class="bg-white p-6 rounded-lg shadow-md border-t-4 border-red-500"
            >
              <h3 class="text-xl font-semibold text-slate-700 mb-4">
                Immediate Actions (Next 30 Days)
              </h3>
              <ul class="space-y-3">
                <li class="flex items-start">
                  <input
                    type="checkbox"
                    class="h-5 w-5 rounded border-gray-300 text-sky-600 focus:ring-sky-500 mt-1 mr-3"
                  /><span class="text-slate-700"
                    >File ITR-2 for AY 2025-26, explicitly opting for the Old
                    Regime.</span
                  >
                </li>
                <li class="flex items-start">
                  <input
                    type="checkbox"
                    class="h-5 w-5 rounded border-gray-300 text-sky-600 focus:ring-sky-500 mt-1 mr-3"
                  /><span class="text-slate-700"
                    >Review and upgrade health insurance to the recommended
                    structure.</span
                  >
                </li>
                <li class="flex items-start">
                  <input
                    type="checkbox"
                    class="h-5 w-5 rounded border-gray-300 text-sky-600 focus:ring-sky-500 mt-1 mr-3"
                  /><span class="text-slate-700"
                    >Consult a lawyer to draft a legally valid Will.</span
                  >
                </li>
                <li class="flex items-start">
                  <input
                    type="checkbox"
                    class="h-5 w-5 rounded border-gray-300 text-sky-600 focus:ring-sky-500 mt-1 mr-3"
                  /><span class="text-slate-700"
                    >Gather all tax documents (Form 16, rent receipts,
                    investment proofs).</span
                  >
                </li>
              </ul>
            </div>

            <div
              class="bg-white p-6 rounded-lg shadow-md border-t-4 border-amber-500"
            >
              <h3 class="text-xl font-semibold text-slate-700 mb-4">
                Short-Term Actions (1-6 Months)
              </h3>
              <ul class="space-y-3">
                <li class="flex items-start">
                  <input
                    type="checkbox"
                    class="h-5 w-5 rounded border-gray-300 text-sky-600 focus:ring-sky-500 mt-1 mr-3"
                  /><span class="text-slate-700"
                    >Calculate and start building your Emergency Fund via
                    automated transfers.</span
                  >
                </li>
                <li class="flex items-start">
                  <input
                    type="checkbox"
                    class="h-5 w-5 rounded border-gray-300 text-sky-600 focus:ring-sky-500 mt-1 mr-3"
                  /><span class="text-slate-700"
                    >Begin SIPs in recommended mutual funds for retirement &
                    child's future.</span
                  >
                </li>
                <li class="flex items-start">
                  <input
                    type="checkbox"
                    class="h-5 w-5 rounded border-gray-300 text-sky-600 focus:ring-sky-500 mt-1 mr-3"
                  /><span class="text-slate-700"
                    >Realign parents' investments into SCSS and POMIS.</span
                  >
                </li>
                <li class="flex items-start">
                  <input
                    type="checkbox"
                    class="h-5 w-5 rounded border-gray-300 text-sky-600 focus:ring-sky-500 mt-1 mr-3"
                  /><span class="text-slate-700"
                    >Review and update nominations on all financial
                    accounts.</span
                  >
                </li>
              </ul>
            </div>

            <div
              class="bg-white p-6 rounded-lg shadow-md border-t-4 border-green-500"
            >
              <h3 class="text-xl font-semibold text-slate-700 mb-4">
                Ongoing & Annual Reviews
              </h3>
              <ul class="space-y-3">
                <li class="flex items-start">
                  <input
                    type="checkbox"
                    class="h-5 w-5 rounded border-gray-300 text-sky-600 focus:ring-sky-500 mt-1 mr-3"
                  /><span class="text-slate-700"
                    >Schedule an annual financial health check-up to review this
                    plan.</span
                  >
                </li>
                <li class="flex items-start">
                  <input
                    type="checkbox"
                    class="h-5 w-5 rounded border-gray-300 text-sky-600 focus:ring-sky-500 mt-1 mr-3"
                  /><span class="text-slate-700"
                    >Rebalance investment portfolio annually to maintain asset
                    allocation.</span
                  >
                </li>
                <li class="flex items-start">
                  <input
                    type="checkbox"
                    class="h-5 w-5 rounded border-gray-300 text-sky-600 focus:ring-sky-500 mt-1 mr-3"
                  /><span class="text-slate-700"
                    >Review insurance cover every 2-3 years or after a major
                    life event.</span
                  >
                </li>
                <li class="flex items-start">
                  <input
                    type="checkbox"
                    class="h-5 w-5 rounded border-gray-300 text-sky-600 focus:ring-sky-500 mt-1 mr-3"
                  /><span class="text-slate-700"
                    >Annually review rental agreements and market rates for your
                    properties.</span
                  >
                </li>
              </ul>
            </div>
          </div>
        </section>
      </main>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const navLinks = document.querySelectorAll("#main-nav a");
        const sections = document.querySelectorAll(".tab-content");
        const menuToggle = document.getElementById("menu-toggle");
        const sidebar = document.getElementById("sidebar");

        const formatCurrency = (value) =>
          new Intl.NumberFormat("en-IN", {
            style: "currency",
            currency: "INR",
            minimumFractionDigits: 0,
            maximumFractionDigits: 0,
          }).format(value);
        
        const formatCurrencyWithDecimal = (value) => 
          `₹${Number(value).toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;

        function navigateTo(hash) {
          navLinks.forEach((link) =>
            link.classList.toggle("active", link.hash === hash)
          );
          sections.forEach((section) =>
            section.classList.toggle("active", section.id === hash.substring(1))
          );
          window.scrollTo(0, 0);
          if (window.innerWidth < 1024)
            sidebar.classList.add("-translate-x-full");
        }

        navLinks.forEach((link) => {
          link.addEventListener("click", (e) => {
            e.preventDefault();
            navigateTo(e.currentTarget.hash);
            window.location.hash = e.currentTarget.hash;
          });
        });

        menuToggle.addEventListener("click", () =>
          sidebar.classList.toggle("-translate-x-full")
        );

        const assetAllocationCtx = document
          .getElementById("assetAllocationChart")
          .getContext("2d");
        new Chart(assetAllocationCtx, {
          type: "doughnut",
          data: {
            labels: ["Equity", "Debt", "Gold"],
            datasets: [
              {
                data: [65, 25, 10],
                backgroundColor: ["#4f46e5", "#16a34a", "#f59e0b"],
                borderColor: "#f8fafc",
                borderWidth: 4,
                hoverOffset: 8,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: "70%",
            plugins: {
              legend: {
                position: "bottom",
                labels: { padding: 20, font: { size: 14 } },
              },
              tooltip: { callbacks: { label: (c) => `${c.label}: ${c.raw}%` } },
            },
          },
        });

        const taxTabButtons = document.querySelectorAll(".tax-tab-button");
        const taxTabs = document.querySelectorAll(".tax-tab");

        taxTabButtons.forEach((button) => {
          button.addEventListener("click", () => {
            taxTabButtons.forEach((btn) => btn.classList.remove("active"));
            button.classList.add("active");
            taxTabs.forEach((tab) =>
              tab.classList.toggle(
                "active",
                tab.id === `tab-${button.dataset.tab}`
              )
            );
          });
        });

        let propertyCount = 0;
        const propertyList = document.getElementById("property-list");

        function addPropertyCard(data = {}) {
          propertyCount++;
          const card = document.createElement("div");
          card.className = "p-4 border rounded-lg bg-slate-50 relative";
          card.id = `property-${propertyCount}`;
          card.innerHTML = `
            <button class="remove-property-btn absolute top-2 right-2 text-red-500 hover:text-red-700 font-bold text-lg" data-id="${propertyCount}">&times;</button>
            <h4 class="font-semibold mb-2">Property ${propertyCount}</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="text-sm">Property Type</label>
                    <select class="tax-input prop-type">
                        <option value="let_out" ${
                          data.type === "let_out" ? "selected" : ""
                        }>Let Out</option>
                        <option value="deemed_let_out" ${
                          data.type === "deemed_let_out" ? "selected" : ""
                        }>Deemed to be Let Out</option>
                    </select>
                </div>
                <div><label class="text-sm">Gross Annual Rent (₹)</label><input type="number" class="tax-input prop-rent" value="${
                  data.rent || 0
                }"></div>
                <div><label class="text-sm">Municipal Taxes Paid (₹)</label><input type="number" class="tax-input prop-tax" value="${
                  data.tax || 0
                }"></div>
                <div><label class="text-sm">Interest on Loan (₹)</label><input type="number" class="tax-input prop-interest" value="${
                  data.interest || 0
                }"></div>
            </div>
        `;
          propertyList.appendChild(card);
          card
            .querySelector(".remove-property-btn")
            .addEventListener("click", (e) => {
              document
                .getElementById(`property-${e.target.dataset.id}`)
                .remove();
              updateTaxComparison();
            });
        }

        document
          .getElementById("add-property-btn")
          .addEventListener("click", () => addPropertyCard());

        let taxChart;
        const taxForm = document.getElementById("tax-calculator-form");

        function calculateTax({ old: oldIncome, new: newIncome }) {
          const oldSlabs = [
            { limit: 250000, rate: 0 },
            { limit: 500000, rate: 0.05 },
            { limit: 1000000, rate: 0.2 },
            { limit: Infinity, rate: 0.3 },
          ];
          const newSlabs = [
            { limit: 300000, rate: 0 },
            { limit: 600000, rate: 0.05 },
            { limit: 900000, rate: 0.1 },
            { limit: 1200000, rate: 0.15 },
            { limit: 1500000, rate: 0.2 },
            { limit: Infinity, rate: 0.3 },
          ];

          function compute(income, slabSet) {
            let taxPayable = 0;
            let lastLimit = 0;
            for (const slab of slabSet) {
              if (income > lastLimit) {
                const taxableInSlab = Math.min(
                  income - lastLimit,
                  slab.limit - lastLimit
                );
                taxPayable += taxableInSlab * slab.rate;
              }
              lastLimit = slab.limit;
            }
            if (slabSet === newSlabs && income <= 700000) return 0;
            const cess = taxPayable * 0.04;
            return taxPayable + cess;
          }

          return {
            oldTax: compute(oldIncome, oldSlabs),
            newTax: compute(newIncome, newSlabs),
          };
        }

        function updateTaxComparison() {
          const getVal = (id) =>
            parseFloat(document.getElementById(id).value) || 0;

          const basicSalary = getVal("basic_salary") + getVal("basic_arrear");
          const hraReceived = getVal("hra_received") + getVal("hra_arrear");
          const otherSalary = getVal("lta") + getVal("performance_bonus");

          const taxableAllowances =
            getVal("prof_dev_allowance") +
            getVal("books_allowance") +
            getVal("tele_allowance") +
            getVal("health_club_allowance") +
            getVal("other_allowance");
          const giftVoucherVal = getVal("gift_voucher_value");
          const taxableGift = giftVoucherVal > 5000 ? giftVoucherVal : 0;
          const taxableSodexo = Math.max(0, getVal("sodexo_value") - 26400);
          const carPerk = getVal("car_perq");

          const employerPF = getVal("employer_pf_contribution");
          const employerNPS = getVal("employer_nps_contribution");
          const employerSA = getVal("employer_superannuation_contribution");

          const taxableEmployerPF = Math.max(
            0,
            employerPF - basicSalary * 0.12
          );
          const totalEmployerRetirals = employerPF + employerNPS + employerSA;
          const taxableAggregateContribution = Math.max(
            0,
            totalEmployerRetirals - 750000
          );

          const salaryIncome =
            basicSalary +
            hraReceived +
            otherSalary +
            taxableAllowances +
            taxableGift +
            taxableSodexo +
            carPerk +
            taxableEmployerPF +
            taxableAggregateContribution;

          let housePropertyIncome = 0;
          document.querySelectorAll("#property-list > div").forEach((prop) => {
            const rent =
              parseFloat(prop.querySelector(".prop-rent").value) || 0;
            const tax = parseFloat(prop.querySelector(".prop-tax").value) || 0;
            const interest =
              parseFloat(prop.querySelector(".prop-interest").value) || 0;
            const nav = rent - tax;
            const standardDeductionHP = nav * 0.3;
            housePropertyIncome += nav - standardDeductionHP - interest;
          });

          const otherIncomes =
            getVal("interest_income") + getVal("any_other_income");
          const grossTotalIncome =
            salaryIncome + housePropertyIncome + otherIncomes;

          const standardDeductionSalary = 50000;

          const rentPaid = getVal("rent_paid");
          const isMetro = document.getElementById("is_metro").checked;
          const hraExemption1 = hraReceived;
          const hraExemption2 = rentPaid - basicSalary * 0.1;
          const hraExemption3 = basicSalary * (isMetro ? 0.5 : 0.4);
          const hraExemption = Math.max(
            0,
            Math.min(hraExemption1, hraExemption2, hraExemption3)
          );

          const sec80c = Math.min(
            150000,
            getVal("lic") +
              getVal("epf") +
              getVal("tuition_fees") +
              getVal("other_80c")
          );
          const sec80d =
            Math.min(25000, getVal("health_insurance_self")) +
            Math.min(25000, getVal("health_insurance_parents")) +
            Math.min(50000, getVal("health_insurance_parents_sr"));
          const sec80tta = Math.min(10000, getVal("interest_80tta"));
          const profTax = getVal("prof_tax");

          const totalDeductionsOld =
            standardDeductionSalary +
            hraExemption +
            sec80c +
            sec80d +
            sec80tta +
            profTax;

          const taxableIncomeOld = Math.max(
            0,
            grossTotalIncome - totalDeductionsOld
          );
          const taxableIncomeNew = Math.max(
            0,
            grossTotalIncome - standardDeductionSalary
          );

          document.getElementById("taxable_old").textContent =
            formatCurrency(taxableIncomeOld);
          document.getElementById("taxable_new").textContent =
            formatCurrency(taxableIncomeNew);

          const taxes = calculateTax({
            old: taxableIncomeOld,
            new: taxableIncomeNew,
          });
          const savings = Math.max(0, taxes.newTax - taxes.oldTax);

          document.getElementById("savings_total").textContent =
            formatCurrency(savings);
          document.getElementById("estimatedSavings").textContent =
            formatCurrency(savings);

          if (taxChart) {
            taxChart.data.datasets[0].data = [taxes.oldTax, taxes.newTax];
            taxChart.update();
          }
        }

        function createTaxChart() {
          const ctx = document
            .getElementById("taxComparisonChart")
            .getContext("2d");
          taxChart = new Chart(ctx, {
            type: "bar",
            data: {
              labels: ["Old Regime", "New Regime"],
              datasets: [
                {
                  label: "Total Tax Liability",
                  data: [0, 0],
                  backgroundColor: ["#38bdf8", "#fb923c"],
                  borderWidth: 1,
                  borderRadius: 5,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              indexAxis: "y",
              plugins: {
                legend: { display: false },
                tooltip: { callbacks: { label: (c) => formatCurrency(c.raw) } },
              },
              scales: {
                x: {
                  beginAtZero: true,
                  ticks: { callback: (v) => `${formatCurrency(v / 100000)}L` },
                },
              },
            },
          });
        }

        taxForm.addEventListener("input", updateTaxComparison);
        createTaxChart();

        const monthlyExpensesInput = document.getElementById("monthlyExpenses");
        const emergencyFundTarget = document.getElementById(
          "emergencyFundTarget"
        );
        monthlyExpensesInput.addEventListener("input", () => {
          emergencyFundTarget.textContent = formatCurrency(
            (parseFloat(monthlyExpensesInput.value) || 0) * 6
          );
        });

        // Report Management Logic
        const reportNameInput = document.getElementById("reportName");
        const savedReportsSelect = document.getElementById("savedReports");
        const saveBtn = document.getElementById("saveReportBtn");
        const loadBtn = document.getElementById("loadReportBtn");
        const deleteBtn = document.getElementById("deleteReportBtn");

        function getReports() {
          return JSON.parse(localStorage.getItem("financialReports")) || {};
        }

        function saveReports(reports) {
          localStorage.setItem("financialReports", JSON.stringify(reports));
        }

        function updateReportList() {
          const reports = getReports();
          savedReportsSelect.innerHTML = "";
          if (Object.keys(reports).length === 0) {
            savedReportsSelect.innerHTML = "<option>No saved reports</option>";
            loadBtn.disabled = true;
            deleteBtn.disabled = true;
            return;
          }
          loadBtn.disabled = false;
          deleteBtn.disabled = false;
          for (const name in reports) {
            const option = document.createElement("option");
            option.value = name;
            option.textContent = name;
            savedReportsSelect.appendChild(option);
          }
        }

        saveBtn.addEventListener("click", () => {
          const name = reportNameInput.value.trim();
          if (!name) {
            showAlert("Please enter a name for the report.");
            return;
          }

          const reports = getReports();
          if (Object.keys(reports).length >= 3 && !reports[name]) {
            showAlert(
              "You can save a maximum of 3 reports. Please delete an old one or use an existing name to overwrite."
            );
            return;
          }

          const data = { inputs: {}, properties: [] };
          taxForm
            .querySelectorAll('input[type="number"], input[type="text"]')
            .forEach((input) => {
              data.inputs[input.id] = input.value;
            });
          taxForm
            .querySelectorAll('input[type="checkbox"]')
            .forEach((input) => {
              data.inputs[input.id] = input.checked;
            });

          propertyList
            .querySelectorAll(".p-4.border.rounded-lg")
            .forEach((card) => {
              data.properties.push({
                type: card.querySelector(".prop-type").value,
                rent: card.querySelector(".prop-rent").value,
                tax: card.querySelector(".prop-tax").value,
                interest: card.querySelector(".prop-interest").value,
              });
            });

          reports[name] = data;
          saveReports(reports);
          updateReportList();
          showAlert(`Report '${name}' saved successfully!`);
        });

        loadBtn.addEventListener("click", () => {
          const name = savedReportsSelect.value;
          const reports = getReports();
          if (!reports[name]) {
            showAlert("No report selected or report not found.");
            return;
          }
          const data = reports[name];

          reportNameInput.value = name;
          taxForm
            .querySelectorAll('input[type="number"], input[type="text"]')
            .forEach((input) => {
              if (data.inputs[input.id] !== undefined) {
                input.value = data.inputs[input.id];
              }
            });
          taxForm
            .querySelectorAll('input[type="checkbox"]')
            .forEach((input) => {
              if (data.inputs[input.id] !== undefined) {
                input.checked = data.inputs[input.id];
              }
            });

          propertyList.innerHTML = "";
          propertyCount = 0;
          data.properties.forEach((propData) => addPropertyCard(propData));

          updateTaxComparison();
          showAlert(`Report '${name}' loaded.`);
        });

        deleteBtn.addEventListener("click", () => {
          const name = savedReportsSelect.value;
          const reports = getReports();
          if (!reports[name]) {
            showAlert("No report selected to delete.");
            return;
          }
          delete reports[name];
          saveReports(reports);
          updateReportList();
          showAlert(`Report '${name}' deleted.`);
        });

        // AI Payslip Analyzer
        const payslipUploader = document.getElementById("payslipUploader");
        const analyzePayslipBtn = document.getElementById("analyzePayslipBtn");
        const aiStatus = document.getElementById("aiStatus");
        let payslipFile = null;

        payslipUploader.addEventListener("change", (event) => {
          payslipFile = event.target.files[0];
          if (payslipFile) {
            analyzePayslipBtn.disabled = false;
            aiStatus.textContent = `Selected file: ${payslipFile.name}`;
          } else {
            analyzePayslipBtn.disabled = true;
          }
        });

        analyzePayslipBtn.addEventListener("click", async () => {
          if (!payslipFile) {
            showAlert("Please select a payslip image or PDF first.");
            return;
          }

          aiStatus.textContent = "Processing... This may take a moment.";
          analyzePayslipBtn.disabled = true;

          const reader = new FileReader();
          reader.readAsDataURL(payslipFile);
          reader.onload = async () => {
            const base64ImageData = reader.result.split(",")[1];

            const prompt = `You are an expert financial data extractor for Indian payslips. Analyze the payslip image or PDF document. Extract the key financial components. If a value is monthly, multiply it by 12 to get the annual amount. If a component is not found, use a value of 0. Return a JSON object with the exact keys from the provided schema.`;

            const payload = {
              contents: [
                {
                  role: "user",
                  parts: [
                    { text: prompt },
                    {
                      inlineData: {
                        mimeType: payslipFile.type,
                        data: base64ImageData,
                      },
                    },
                  ],
                },
              ],
              generationConfig: {
                responseMimeType: "application/json",
                responseSchema: {
                  type: "OBJECT",
                  properties: {
                    basic_salary: { type: "NUMBER" },
                    hra_received: { type: "NUMBER" },
                    performance_bonus: { type: "NUMBER" },
                    employer_pf_contribution: { type: "NUMBER" },
                    epf: { type: "NUMBER" },
                    prof_tax: { type: "NUMBER" },
                    other_allowance: { type: "NUMBER" },
                  },
                  required: ["basic_salary", "hra_received", "epf"],
                },
              },
            };

            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
              const response = await fetch(apiUrl, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload),
              });

              if (!response.ok) {
                throw new Error(`API Error: ${response.statusText}`);
              }

              const result = await response.json();

              if (
                result.candidates &&
                result.candidates.length > 0 &&
                result.candidates[0].content &&
                result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0
              ) {
                const parsedJson = JSON.parse(
                  result.candidates[0].content.parts[0].text
                );
                for (const key in parsedJson) {
                  const inputElement = document.getElementById(key);
                  if (inputElement) {
                    inputElement.value = parsedJson[key];
                  }
                }
                updateTaxComparison();
                aiStatus.textContent =
                  "Payslip analysis complete. Fields have been updated.";
              } else {
                throw new Error(
                  "Could not extract data. The AI returned an empty response."
                );
              }
            } catch (error) {
              console.error("AI Analysis Error:", error);
              aiStatus.textContent = `Error: ${error.message}`;
              showAlert(
                "Sorry, the AI could not analyze the payslip. Please check the document clarity or enter the data manually."
              );
            } finally {
              analyzePayslipBtn.disabled = false;
            }
          };

          reader.onerror = () => {
            showAlert("Could not read the selected file.");
            aiStatus.textContent = "Error reading file.";
            analyzePayslipBtn.disabled = false;
          };
        });

        // Modal Logic
        const alertModal = document.getElementById("alertModal");
        const modalMessage = document.getElementById("modalMessage");
        const modalCloseBtn = document.getElementById("modalCloseBtn");

        function showAlert(message) {
          modalMessage.textContent = message;
          alertModal.style.display = "flex";
        }

        modalCloseBtn.addEventListener("click", () => {
          alertModal.style.display = "none";
        });

        // ====================================================================
        // START of Integrated Financial Planner Logic
        // ====================================================================

        const financialData = {
            income: [
                { description: 'Your Net Salary', amount: 200000 },
            ],
            fixedExpenses: [
                { description: 'Rent', amount: 59850.00 },
                { description: 'Electricity', amount: 3500.00 },
                { description: 'Cooking Gas', amount: 1250.00 },
                { description: 'Airtel (total)', amount: 5250.00 },
                { description: 'Maid', amount: 5000.00 },
                { description: 'Maintenance-Society', amount: 10400.00 },
                { description: 'Apple', amount: 100.00 },
                { description: 'Coursera', amount: 5000.00 },
                { description: 'Linkedin', amount: 1000.00 }
            ],
            variableExpenses: [
                { description: 'Grocery', amount: 15000.00 },
                { description: 'Medicine', amount: 5000.00 },
                { description: 'School Fees', amount: 9266.67 },
                { description: 'Kids Extra-Cirricular', amount: 10000.00 }
            ],
            savings: [
                { description: 'SG Investment', amount: 70000.00 },
                { description: 'SBI Securities', amount: 5000.00 }
            ]
        };

        let overviewChart, expenseChart;

        function renderFinancialTable(type) {
            const tableBody = document.getElementById(`${type}TableBody`);
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            financialData[type].forEach((item, index) => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-200 table-row-hover';
                row.innerHTML = `
                    <td class="py-2 pr-2">
                        <input type="text" value="${item.description}" class="w-full bg-transparent tax-input" data-field="description" data-type="${type}" data-index="${index}">
                    </td>
                    <td class="py-2 pr-2">
                        <input type="number" value="${item.amount}" class="w-full bg-transparent text-right tax-input" data-field="amount" data-type="${type}" data-index="${index}">
                    </td>
                    <td class="py-2 w-10">
                        <button class="btn-danger p-1 rounded-full text-xs delete-item-btn" data-type="${type}" data-index="${index}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function handleAddItem(event) {
            const container = event.target.closest('[data-type]');
            if (!container) return;
            
            const type = container.dataset.type;
            const descInput = container.querySelector(`input[id^="new"][type="text"]`);
            const amountInput = container.querySelector(`input[id^="new"][type="number"]`);

            if (descInput && amountInput) {
                const description = descInput.value.trim();
                const amount = parseFloat(amountInput.value);

                if(description && !isNaN(amount) && amount >= 0) {
                    financialData[type].push({ description, amount });
                    descInput.value = '';
                    amountInput.value = '';
                    updateFinancialDashboard();
                } else {
                    showAlert('Please enter a valid description and a positive amount.');
                }
            }
        }

        function handleFinancialTableChange(event) {
            const { type, index, field } = event.target.dataset;
            let value = event.target.value;

            if (field === 'amount') {
                value = parseFloat(value);
                if (isNaN(value)) return;
            }

            if (type && index && field) {
                financialData[type][index][field] = value;
                updateFinancialDashboard();
            }
        }
        
        function handleDeleteItem(event) {
            const deleteButton = event.target.closest('.delete-item-btn');
            if (deleteButton) {
                const type = deleteButton.dataset.type;
                const index = deleteButton.dataset.index;
                if (type && index) {
                    financialData[type].splice(index, 1);
                    updateFinancialDashboard();
                }
            }
        }

        function calculateFinancialTotals() {
            const totalIncome = financialData.income.reduce((sum, item) => sum + item.amount, 0);
            const totalFixedExpenses = financialData.fixedExpenses.reduce((sum, item) => sum + item.amount, 0);
            const totalVariableExpenses = financialData.variableExpenses.reduce((sum, item) => sum + item.amount, 0);
            const totalExpenses = totalFixedExpenses + totalVariableExpenses;
            const totalSavings = financialData.savings.reduce((sum, item) => sum + item.amount, 0);
            const netSurplus = totalIncome - totalExpenses - totalSavings;
            return { totalIncome, totalExpenses, totalSavings, netSurplus, totalFixedExpenses, totalVariableExpenses };
        }

        function updateFinancialDashboard() {
            Object.keys(financialData).forEach(type => renderFinancialTable(type));

            const totals = calculateFinancialTotals();
            
            const totalIncomeEl = document.getElementById('totalIncome');
            const totalExpensesEl = document.getElementById('totalExpenses');
            const totalSavingsEl = document.getElementById('totalSavings');
            const netSurplusEl = document.getElementById('netSurplus');
            const netSurplusTitleEl = document.getElementById('netSurplusTitle');

            if (totalIncomeEl && totalExpensesEl && totalSavingsEl && netSurplusEl && netSurplusTitleEl) {
                totalIncomeEl.textContent = formatCurrencyWithDecimal(totals.totalIncome);
                totalExpensesEl.textContent = formatCurrencyWithDecimal(totals.totalExpenses);
                totalSavingsEl.textContent = formatCurrencyWithDecimal(totals.totalSavings);
                
                netSurplusEl.textContent = formatCurrencyWithDecimal(totals.netSurplus);
                netSurplusEl.classList.toggle('text-green-600', totals.netSurplus >= 0);
                netSurplusEl.classList.toggle('text-red-600', totals.netSurplus < 0);
                netSurplusEl.classList.toggle('text-slate-800', totals.netSurplus === 0);
                netSurplusTitleEl.textContent = totals.netSurplus >= 0 ? "Net Surplus" : "Net Deficit";
            }

            updateFinancialCharts(totals);
        }

        function updateFinancialCharts(totals) {
            const { totalExpenses, totalSavings } = totals;
            
            const overviewData = {
                labels: ['Expenses', 'Savings', 'Surplus'],
                datasets: [{
                    data: [totalExpenses, totalSavings, Math.max(0, totals.netSurplus)],
                    backgroundColor: ['#EF5350', '#42A5F5', '#66BB6A'],
                    borderColor: '#FDFBF8',
                    borderWidth: 4,
                }]
            };

            const overviewCtx = document.getElementById('overviewChart');
            if (overviewCtx) {
                if (overviewChart) {
                    overviewChart.data = overviewData;
                    overviewChart.update();
                } else {
                    overviewChart = new Chart(overviewCtx.getContext('2d'), {
                        type: 'doughnut',
                        data: overviewData,
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            cutout: '60%',
                            plugins: {
                                legend: { position: 'bottom' },
                                tooltip: { callbacks: { label: (c) => `${c.label}: ${formatCurrencyWithDecimal(c.parsed)}` } }
                            }
                        }
                    });
                }
            }

            const allExpenses = [...financialData.fixedExpenses, ...financialData.variableExpenses].filter(e => e.amount > 0);
            const expenseData = {
                labels: allExpenses.map(e => e.description),
                datasets: [{
                    label: 'Expense Amount',
                    data: allExpenses.map(e => e.amount),
                    backgroundColor: '#86A397',
                    borderColor: '#5A6F64',
                    borderWidth: 1,
                }]
            };
            
            const expenseCtx = document.getElementById('expenseChart');
            if (expenseCtx) {
                if (expenseChart) {
                    expenseChart.data = expenseData;
                    expenseChart.update();
                } else {
                    expenseChart = new Chart(expenseCtx.getContext('2d'), {
                        type: 'bar',
                        data: expenseData,
                        options: {
                            indexAxis: 'y',
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false },
                                tooltip: { callbacks: { label: (c) => `${c.label}: ${formatCurrencyWithDecimal(c.parsed.x)}` } }
                            },
                            scales: {
                                x: { ticks: { callback: (v) => formatCurrencyWithDecimal(v) } }
                            }
                        }
                    });
                }
            }
        }

        // ====================================================================
        // END of Integrated Financial Planner Logic
        // ====================================================================

        // Initial calls
        navigateTo(window.location.hash || "#dashboard");
        updateTaxComparison();
        emergencyFundTarget.textContent = formatCurrency(
          (parseFloat(monthlyExpensesInput.value) || 0) * 6
        );
        updateReportList();
        updateFinancialDashboard();

        // Add event listeners for the financial planner tables
        document.querySelectorAll('.add-item-btn').forEach(button => {
            button.addEventListener('click', handleAddItem);
        });

        document.querySelectorAll('.financial-planner-card tbody').forEach(tbody => {
            tbody.addEventListener('input', handleFinancialTableChange);
            tbody.addEventListener('click', handleDeleteItem);
        });
      });
    </script>
  </body>
</html>
